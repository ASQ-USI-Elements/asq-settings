<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../asq-base/asq-base.html">

<!--
TODO

@element asq-settings
@group ASQ Elements
@homepage http://github.com/ASQ-USI-Elements/asq-settings
-->
<polymer-element name="asq-settings" hidden>
  <script>
    (function() {

      var p = {

        publish: {
          /**
           * The maximum number of submissions that are allowed.
           * 
           * -1 -> infinite 
           * 0  -> no submissions allowed
           * [1-9]+[0-9]* -> finite 
           * 
           * @attribute maxnumsubmissions
           * @type number
           * @default 1
           */
          maxnumsubmissions: {value: 1, reflect: true},

          /**
           * Options are *self* and *follow*.
           * 
           * @attribute slideflow
           * @type 'follow' | 'self'
           * @default 'follow'
           */
          slideflow: {value: 'follow', reflect: true},

          /**
           * assessment
           * 
           * @attribute assessment
           * @type 'self' | 'peer' | 'staff'
           * @default 'self'
           */
          assessment: {value: 'self', reflect: true},
        },


        created: function(){
          document.addEventListener('asq-ready', function(evt){
            try{
              this.subscribeToEvents(evt.detail.asqEventBus)
            }catch(err){
              console.debug('failed to subscribeToEvents');
            }
          }.bind(this));
        },

        subscribeToEvents: function(eventBus){
          eventBus.on('asq:update_live_presentation_settings', this.onUpdateSettings.bind(this));
        },

        onUpdateSettings: function(evt) {
          if ( evt.scope === 'presentation' ) {
            var settings = evt.settings;
            Object.keys(settings).forEach(function(key, index){
              if ( this.hasAttributes(key) ) {
                this.setAttribute(key.toLowerCase(), settings[key]);
                this[key] = settings[key];
              }
            }, this);
          }
        }
      }
      
      ASQ.asqify(p);
      Polymer('asq-settings', p);

    })();
  </script>
</polymer-element>
